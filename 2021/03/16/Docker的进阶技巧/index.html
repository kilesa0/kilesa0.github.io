<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Docker的进阶技巧 | Kilesa</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="一、容器数据卷容器之间可以有一个数据共享的技术！Docker容器产生的数据同步到本地！ 1.方式一123sudo docker run -it -v 主机内的目录:容器内部端口 -p 主机端口：容器端口  #sudo防止没有权限#在容器外使用 ，查看Mounts看是否挂载成功docker inspect 容器ID    实际测试，安装MySQL1234docker pull mysql:5.7">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker的进阶技巧">
<meta property="og:url" content="https://gitee.com/kilesa/kilesa/2021/03/16/Docker%E7%9A%84%E8%BF%9B%E9%98%B6%E6%8A%80%E5%B7%A7/index.html">
<meta property="og:site_name" content="Kilesa">
<meta property="og:description" content="一、容器数据卷容器之间可以有一个数据共享的技术！Docker容器产生的数据同步到本地！ 1.方式一123sudo docker run -it -v 主机内的目录:容器内部端口 -p 主机端口：容器端口  #sudo防止没有权限#在容器外使用 ，查看Mounts看是否挂载成功docker inspect 容器ID    实际测试，安装MySQL1234docker pull mysql:5.7">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-03-16T06:38:27.000Z">
<meta property="article:modified_time" content="2021-03-16T11:47:04.067Z">
<meta property="article:author" content="鱼糕先生">
<meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Kilesa</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">主页</a>
        
          <a class="main-nav-link" href="/archives">文章</a>
        
      </nav>
      <nav id="sub-nav">
        
      </nav>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Docker的进阶技巧" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/16/Docker%E7%9A%84%E8%BF%9B%E9%98%B6%E6%8A%80%E5%B7%A7/" class="article-date">
  <time class="dt-published" datetime="2021-03-16T06:38:27.000Z" itemprop="datePublished">2021-03-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Docker的进阶技巧
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="一、容器数据卷"><a href="#一、容器数据卷" class="headerlink" title="一、容器数据卷"></a>一、容器数据卷</h2><p>容器之间可以有一个数据共享的技术！Docker容器产生的数据同步到本地！</p>
<h4 id="1-方式一"><a href="#1-方式一" class="headerlink" title="1.方式一"></a>1.方式一</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run -it -v 主机内的目录:容器内部端口 -p 主机端口：容器端口  #sudo防止没有权限</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在容器外使用 ，查看Mounts看是否挂载成功</span></span><br><span class="line">docker inspect 容器ID  </span><br></pre></td></tr></table></figure>

<h6 id="实际测试，安装MySQL"><a href="#实际测试，安装MySQL" class="headerlink" title="实际测试，安装MySQL"></a>实际测试，安装MySQL</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql:5.7  #下载MySQL</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">运行MySQL镜像，挂载配置目录和数据目录并设置密码</span></span><br><span class="line">docker run -d -p:3310:3306 -v /home/mysql/conf:/etc/mysql/conf.d \</span><br><span class="line">    -v /home/mysql/data:/etc/var/lib/mysql  -e MYSQL_ROOT_PASSWORD=密码 --name mysql01 mysql:5.7</span><br></pre></td></tr></table></figure>

<h6 id="具名挂载和匿名挂载"><a href="#具名挂载和匿名挂载" class="headerlink" title="具名挂载和匿名挂载"></a>具名挂载和匿名挂载</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">匿名挂载</span></span><br><span class="line">-v 容器内路径</span><br><span class="line">docker run -d -p --name nginx01 -v /etc/nginx nginx #未指定主机路径地址，挂载卷没有名字</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看所有 volume 的情况</span></span><br><span class="line">docker volume ls</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">具名挂载</span></span><br><span class="line">docker run -d -p --name nginx01 -v juming-nginx /etc/nginx  nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如何确定是具名挂载还是匿名挂载</span></span><br><span class="line">-v 容器内路径            #匿名挂载</span><br><span class="line">-v 卷名:容器内路径        #具名挂载</span><br><span class="line">-v /宿主机路径:容器内路径  #指定路径挂载</span><br></pre></td></tr></table></figure>

<p>所有docker容器内的卷，没有指定目录的情况下都在<code>/var/lib/docker/volume/</code></p>
<p>数据在<code>/var/lib/docker/volume/xxx/_data</code></p>
<h6 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -P  --name nginx02  -v juming-nginx:/etc/nginx:ro nginx</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">通过 -v 容器内路径:ro rw 改变读写权限</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ro  <span class="built_in">readonly</span>    <span class="comment">#只读</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">rw  readwrite   <span class="comment">#可读可写</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ro 只要看到ro就说明这个路径只能通过宿主机改变</span></span><br></pre></td></tr></table></figure>

<h4 id="2-方式二"><a href="#2-方式二" class="headerlink" title="2.方式二"></a>2.方式二</h4><h6 id="初识Dockerfile"><a href="#初识Dockerfile" class="headerlink" title="初识Dockerfile"></a>初识Dockerfile</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Dockerfile命令都是大写</span></span><br><span class="line">FROM centos                      #用centos为基础制作镜像</span><br><span class="line"></span><br><span class="line">VOLUME [&quot;volume01&quot;,&quot;volume02&quot;]   #挂载数据卷</span><br><span class="line"></span><br><span class="line">CMD echo &quot;----end-----&quot;          #用来确定是否走完</span><br><span class="line">CMD /bin/bash                    #用bash运行</span><br></pre></td></tr></table></figure>

<h6 id="使用Dockerfile"><a href="#使用Dockerfile" class="headerlink" title="使用Dockerfile"></a>使用Dockerfile</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker build -f 文件 -t kilesa/centos:1.0 .  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-f 指定dockerfile文件</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-t 构成的镜像,加上版本号  镜像名前面不能有 /</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">.  生产在当前路径</span></span><br></pre></td></tr></table></figure>

<h4 id="3-多个MySQL实现数据共享"><a href="#3-多个MySQL实现数据共享" class="headerlink" title="3.多个MySQL实现数据共享"></a>3.多个MySQL实现数据共享</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 3310:3306 -v /etc/mysql/conf.d -v /var/lib/mysql \ </span><br><span class="line">     -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7   #启动第一个MySQL并挂载配置文件和数据文件</span><br><span class="line">docker run -d  -p 3309:3306  -e MYSQL_ROOT_PASSWORD=123456\</span><br><span class="line">     --name mysql02  --volumes-form mysql01  mysql:5.7        #启动第二个MySQL并用  --volumes-form  绑定第一个MySQL的挂载</span><br></pre></td></tr></table></figure>

<h2 id="二、Dockerfile"><a href="#二、Dockerfile" class="headerlink" title="二、Dockerfile"></a>二、Dockerfile</h2><h6 id="构建步骤"><a href="#构建步骤" class="headerlink" title="构建步骤:"></a>构建步骤:</h6><ol>
<li>编写一个dockerfile文件</li>
<li>docker build 构建一个镜像</li>
<li>docker run 运行镜像</li>
<li>docker push 发布镜像（DockerHub，阿里云镜像仓库）</li>
</ol>
<h4 id="1-基础命令"><a href="#1-基础命令" class="headerlink" title="1.基础命令"></a>1.基础命令</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span>          <span class="comment">#基础镜像，一切从这里开始构建</span></span><br><span class="line"><span class="keyword">MAINTAINER</span>    <span class="comment">#镜像是谁写的，姓名+邮箱  kilesa&lt;邮箱&gt;</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash">           <span class="comment">#构建镜像时需要运行的命令</span></span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash">           <span class="comment">#添加内容,自动解压</span></span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash">       <span class="comment">#镜像的工作目录</span></span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="language-bash">        <span class="comment">#挂载的目录</span></span></span><br><span class="line"><span class="keyword">EXPOSE</span>        <span class="comment">#暴露端口配置</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash">           <span class="comment">#指定这个容器启动时要运行的命令</span></span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash">    <span class="comment">#指定这个容器启动时要运行的命令,可以追加命令</span></span></span><br><span class="line"><span class="keyword">ONBUILD</span>       <span class="comment">#当构建一个被继承 Dockerfile 这个时候就会运行 ONBUILD 的指令。触发指令</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash">          <span class="comment">#类似ADD，将我们的文件拷贝到镜像中</span></span></span><br><span class="line"><span class="keyword">ENV</span>           <span class="comment">#构建的时候设置环境变量</span></span><br></pre></td></tr></table></figure>

<h4 id="2-实战测试"><a href="#2-实战测试" class="headerlink" title="2.实战测试"></a>2.实战测试</h4><blockquote>
<h6 id="Docker-Hub-中-99-的镜像都是从最基础的-FROM-scratch-，然后配置需要的软件和配置来进行构建的"><a href="#Docker-Hub-中-99-的镜像都是从最基础的-FROM-scratch-，然后配置需要的软件和配置来进行构建的" class="headerlink" title="Docker Hub 中 99% 的镜像都是从最基础的  FROM scratch ，然后配置需要的软件和配置来进行构建的"></a>Docker Hub 中 99% 的镜像都是从最基础的  FROM scratch ，然后配置需要的软件和配置来进行构建的</h6></blockquote>
<h6 id="编写配置文件"><a href="#编写配置文件" class="headerlink" title="编写配置文件"></a>编写配置文件</h6><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos                     <span class="comment">#继承自centos</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">MAINTAINER</span> kilesa&lt;邮箱&gt;          <span class="comment">#Dockerfile的作者</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> MYPATH /usr/local           <span class="comment">#设置环境变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> <span class="variable">$MYPATH</span>                 <span class="comment">#用环境变量设置工作目录</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash">  yum -y install vim         <span class="comment">#安装一个vim</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash">  yum -y install net-tools   <span class="comment">#安装一个net-tools</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span>                       <span class="comment">#暴露80端口</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash">  <span class="built_in">echo</span> <span class="variable">$MYPATH</span>               <span class="comment">#输出环境变量</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash">  <span class="built_in">echo</span> <span class="string">&quot;----end-----&quot;</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash">  /bin/bash                  <span class="comment">#进入bash命令行</span></span></span><br></pre></td></tr></table></figure>

<h6 id="docker-build-构建一个镜像"><a href="#docker-build-构建一个镜像" class="headerlink" title="docker build 构建一个镜像"></a>docker build 构建一个镜像</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker build -f mydockerfile -t mycentos:0.1 . </span><br><span class="line">docker history  镜像ID    #查看镜像的构建历史</span><br></pre></td></tr></table></figure>

<h6 id="CMD与ENTRYPOINT的区别"><a href="#CMD与ENTRYPOINT的区别" class="headerlink" title="CMD与ENTRYPOINT的区别"></a>CMD与ENTRYPOINT的区别</h6><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;-a&quot;</span>]  <span class="comment">#编译后,docker run 容器ID  会执行 ls -a ,用 docker run 容器ID -l 会报错</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash">  [<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;-a&quot;</span>] <span class="comment">#编译后,用 docker run 容器ID -l 相当于 执行了 ls -al</span></span></span><br></pre></td></tr></table></figure>

<h4 id="3-ADD的使用"><a href="#3-ADD的使用" class="headerlink" title="3.ADD的使用"></a>3.ADD的使用</h4><ol>
<li>准备镜像文件 ， tomcat压缩包 ，jdk压缩包</li>
<li>编写Dockerfile文件,官方命名<code>Dockerfile</code></li>
</ol>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos                                                    <span class="comment">#继承自centos</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">MAINTAINER</span> kilesa&lt;邮箱&gt;                                         <span class="comment">#Dockerfile的作者</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash">  readme.txt /usr/local/radme.txt                          <span class="comment">#拷贝文件,提前准备的说明文件</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash">  JDK  /usr/local                                           <span class="comment">#添加jdk，会自动解压</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash">  tomcat  /usr/local                                        <span class="comment">#添加Tomcat</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash">  yum -y install vim                                        <span class="comment">#安装一个vim</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> MYPATH /usr/local                                          <span class="comment">#设置环境变量</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> <span class="variable">$MYPATH</span>                 		                       <span class="comment">#用环境变量设置工作目录</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> JAVA_HOME  /usr/local/jdk</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> CLASSPATH  $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar  <span class="comment">#设置Java环境</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> CATALINT_HOME /usr/local/tomcat                            </span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> CATALINT_BASH /usr/local/tomcat</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> PATH $PATH:$JAVA_HOME/bin:$CATALINT_HOME/lib:$CATALINT_HOME/bin  <span class="comment">#合并环境变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span>  <span class="comment">#暴露8080端口</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash">  /usr/local/tomcat/startup.sh &amp;&amp; <span class="built_in">tail</span> -F /usr/local/tomcat/bin/catalina.out <span class="comment">#运行tomcat </span></span></span><br></pre></td></tr></table></figure>

<p>  3.构建镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t diytomcat .     #使用官方名字，不用 -f 指定</span><br></pre></td></tr></table></figure>

<p> 4.运行镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 9090:8080 --name kilesa -v \</span><br><span class="line">        /home/kilesa/build/tomcat/test:/usr/local/tomcat/webapps/test \</span><br><span class="line">        -v /home/kilesa/build/tomcat/tomcatlogs/:/usr/local/tomcat/logs diytomcat</span><br></pre></td></tr></table></figure>

<h4 id="4-发布到DockerHub"><a href="#4-发布到DockerHub" class="headerlink" title="4.发布到DockerHub"></a>4.发布到DockerHub</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker login -u 用户名 #登录dockerhub</span><br><span class="line">docker tag 镜像ID kilesa/tomcat:1.0  #不设置tag不能提交</span><br><span class="line">docker push 镜像名字:版本  #镜像命名规则 kilesa/tomcat</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://hub.docker.com/">DockerHub</a></p>
<h4 id="5-发布到阿里云镜像"><a href="#5-发布到阿里云镜像" class="headerlink" title="5.发布到阿里云镜像"></a>5.发布到阿里云镜像</h4><p>1.登录到阿里云</p>
<p>2.找到容器镜像服务</p>
<p>3.创建命名空间</p>
<p>4.创建容器镜像</p>
<p>5.根据官方介绍发布</p>
<p><a target="_blank" rel="noopener" href="https://cr.console.aliyun.com">阿里云镜像</a></p>
<h2 id="三、Docker网络"><a href="#三、Docker网络" class="headerlink" title="三、Docker网络"></a>三、Docker网络</h2><h4 id="1-link连接两个容器"><a href="#1-link连接两个容器" class="headerlink" title="1.link连接两个容器"></a>1.link连接两个容器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -P --name tomcat01 tomcat  #启动第一个tomcat </span><br><span class="line">docker run -d -P --name tomcat02 --link tomcat02 tomcat #启动第二个tomcat，并连接第一个tomcat</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这种方式连接的是单项连接,只可以tomcat02访问tomcat01</span></span><br><span class="line">docker exec it tomcat02 ping tomcat01 #tomcat02  ping  tomcat01</span><br></pre></td></tr></table></figure>

<blockquote>
<p>不推荐使用，docker0不支持容器名连接访问</p>
</blockquote>
<h4 id="2-自定义网络"><a href="#2-自定义网络" class="headerlink" title="2.自定义网络"></a>2.自定义网络</h4><h6 id="网络模式"><a href="#网络模式" class="headerlink" title="网络模式"></a>网络模式</h6><ul>
<li>bridge ：桥接 docker（默认，自己创建也使用bridge ）</li>
<li>none：不配置网络</li>
<li>host：和宿主机共享网络</li>
<li>container：容器网络连通！（用得少，局限大）</li>
</ul>
<h6 id="自定义网络"><a href="#自定义网络" class="headerlink" title="自定义网络"></a>自定义网络</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -P --name tomcat01 --net bridge tomcat #默认操作</span><br><span class="line">docker run -d -P --name tomcat01</span><br><span class="line"></span><br><span class="line">docker network create --driver bridge \ </span><br><span class="line">    --subnet 192.168.0.0/16  --getway192.168.0.01 mynet</span><br><span class="line">    #--driver bridge 默认的桥接模式</span><br><span class="line">    #--subnet 192.168.0.0/16  子网</span><br><span class="line">    #--getway192.168.0.01     网关</span><br><span class="line">docker run -d -P --name tomcat-net-01 --net mynet tomcat  #第一个容器</span><br><span class="line">docker run -d -P --name tomcat-net-02 --net mynet tomcat  #第二个容器</span><br><span class="line"></span><br><span class="line">docker exec -it tomcat-net-01 ping tomcat-net-02 #这样可以直接 ping 通</span><br></pre></td></tr></table></figure>

<h6 id="网络连通"><a href="#网络连通" class="headerlink" title="网络连通"></a>网络连通</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network connect mynet tomcat01  #连通docker01和mynet</span><br></pre></td></tr></table></figure>

<h2 id="四、实战：部署Redis集群"><a href="#四、实战：部署Redis集群" class="headerlink" title="四、实战：部署Redis集群"></a>四、实战：部署Redis集群</h2><h4 id="1-创建网卡和Redis容器"><a href="#1-创建网卡和Redis容器" class="headerlink" title="1.创建网卡和Redis容器"></a>1.创建网卡和Redis容器</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">docker network create redis --subnet 172.38.0.0/16  #创建网卡</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">通过脚本创建6个Redis配置</span></span><br><span class="line">for port in $(seq 1 6);\</span><br><span class="line">do \</span><br><span class="line">mkdir -p /mydata/redis/node-$(port)/conf</span><br><span class="line">touch /mydata/redis/node-$(port)/conf/redis.conf</span><br><span class="line">cat &lt;&lt; EOF &gt;/mydata/redis/node-$(port)/conf/redis.conf</span><br><span class="line">port 6379</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">cluster-announce-ip 172.38.0.1$(port)</span><br><span class="line">cluster-announce-port 6379</span><br><span class="line">cluster-announce-bus-port 16379</span><br><span class="line">appendnoly yes</span><br><span class="line">EOF</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">docker run -p 6371:6379 -p1637数字:16379 --name -redis-1 \</span><br><span class="line">      -v /mydata/redis/node-数字/data:/data \ </span><br><span class="line">      -v /mydata/redis/node-数字/conf:/etc/redis/redis.conf \ </span><br><span class="line">      -d --net redis --ip 172.38.0.1数字 redis:5.0.9-alpine3.11 redis-server \</span><br><span class="line">      /etc/redis/redis.conf                           #需要启动6个</span><br></pre></td></tr></table></figure>

<h4 id="2-创建集群"><a href="#2-创建集群" class="headerlink" title="2.创建集群"></a>2.创建集群</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it redis-1 /bin/sh    #redis用的是 /bin/sh  进入容器1</span><br><span class="line">redis-cli --cluster create 172.38.0.11:6379 \</span><br><span class="line">                           172.38.0.12:6379 \</span><br><span class="line">                           172.38.0.13:6379 \ </span><br><span class="line">                           172.38.0.14:6379 \ </span><br><span class="line">                           172.38.0.15:6379 \</span><br><span class="line">                           172.38.0.16:6379  --cluste-replicas 1  #创建集群 cluste-replicas 1 很重要</span><br></pre></td></tr></table></figure>

<h4 id="3-连接集群"><a href="#3-连接集群" class="headerlink" title="3.连接集群"></a>3.连接集群</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -c #连接集群</span><br></pre></td></tr></table></figure>

<h2 id="五、SpringBoot微服务打包成Docker镜像"><a href="#五、SpringBoot微服务打包成Docker镜像" class="headerlink" title="五、SpringBoot微服务打包成Docker镜像"></a>五、SpringBoot微服务打包成Docker镜像</h2><h4 id="1-Dockerfile文件"><a href="#1-Dockerfile文件" class="headerlink" title="1.Dockerfile文件"></a>1.Dockerfile文件</h4><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> java:<span class="number">8</span>  <span class="comment">#基于java 8 制作镜像</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> *.jar  /app.jar   <span class="comment">#讲目录下所有 .jar文件拷贝并命名为 app.jar</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;--server.port=8080&quot;</span>]  <span class="comment">#设置端口 8080</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span>      <span class="comment">#暴露端口8080 </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>,<span class="string">&quot;-jar&quot;</span>,<span class="string">&quot;/app/jar&quot;</span>]  <span class="comment">#执行java -jar 命令</span></span></span><br></pre></td></tr></table></figure>

<h4 id="2-打包镜像"><a href="#2-打包镜像" class="headerlink" title="2.打包镜像"></a>2.打包镜像</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t kilesa .</span><br></pre></td></tr></table></figure>

<h4 id="3-运行镜像"><a href="#3-运行镜像" class="headerlink" title="3.运行镜像"></a>3.运行镜像</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -P --name kilesa-springboot kilesa</span><br></pre></td></tr></table></figure>

<h4 id="4-测试访问"><a href="#4-测试访问" class="headerlink" title="4.测试访问"></a>4.测试访问</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:端口号</span><br></pre></td></tr></table></figure>


      
    </div>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/04/01/Golang%E8%B0%83%E7%94%A8%E5%A4%A7%E6%BC%A0%E6%8F%92%E4%BB%B6%E5%BF%AB%E9%80%9F%E7%99%BB%E5%BD%95Wegame/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          Golang调用大漠插件快速登录Wegame
        
      </div>
    </a>
  
  
    <a href="/2021/03/12/Docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title">Docker的基本使用</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Docker/" rel="tag">Docker</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Github/" rel="tag">Github</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Golang/" rel="tag">Golang</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JetBrains/" rel="tag">JetBrains</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Markdown/" rel="tag">Markdown</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/" rel="tag">Mysql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spleeter/" rel="tag">Spleeter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tampermonkey/" rel="tag">Tampermonkey</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ios/" rel="tag">ios</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Docker/" style="font-size: 12.5px;">Docker</a> <a href="/tags/Github/" style="font-size: 10px;">Github</a> <a href="/tags/Golang/" style="font-size: 20px;">Golang</a> <a href="/tags/JetBrains/" style="font-size: 10px;">JetBrains</a> <a href="/tags/Linux/" style="font-size: 12.5px;">Linux</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/Nginx/" style="font-size: 10px;">Nginx</a> <a href="/tags/Python/" style="font-size: 17.5px;">Python</a> <a href="/tags/Spleeter/" style="font-size: 10px;">Spleeter</a> <a href="/tags/Tampermonkey/" style="font-size: 15px;">Tampermonkey</a> <a href="/tags/hexo/" style="font-size: 12.5px;">hexo</a> <a href="/tags/ios/" style="font-size: 10px;">ios</a> <a href="/tags/nodejs/" style="font-size: 12.5px;">nodejs</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">十二月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">十月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">八月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">六月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">五月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">二月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">二月 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">八月 2020</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a><span class="archive-list-count">6</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/12/31/Python%E5%BA%93%E7%9A%84%E5%AE%89%E8%A3%85/">Python库的安装</a>
          </li>
        
          <li>
            <a href="/2022/12/30/Spleeter%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/">Spleeter的安装与使用</a>
          </li>
        
          <li>
            <a href="/2022/10/21/pyinstxtractor/">pyinstxtractor</a>
          </li>
        
          <li>
            <a href="/2022/10/16/%E7%BD%91%E9%A1%B5%E4%B8%8A%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%8C%89%E9%92%AE/">网页上添加一个按钮</a>
          </li>
        
          <li>
            <a href="/2022/08/16/python%E8%87%AA%E5%8A%A8%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F/">python自动执行程序</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 鱼糕先生<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">主页</a>
  
    <a href="/archives" class="mobile-nav-link">文章</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>